# USER.md — 用户画像定义

## 是什么

USER.md 是宠物对 **主人** 的认知文件。记录了宠物在与主人互动过程中逐渐了解到的信息。

这不是一份"用户注册表"，而是宠物通过对话 **自然积累** 的对主人的了解。

> **替换现有系统**：USER.md 取代了现有 `pets.user_memory` JSON key-value 中的用户信息部分
> （姓名、职业等 key-value 对），以及前端 `longTimeMemory()` 的"判断是否重要"逻辑。
> 新方案中 AI 通过 function calling 直接用 `edit` 工具自主更新用户画像，无需额外 LLM 调用。

## 设计意图

- 让宠物 **记住主人是谁** — 跨会话保持对主人的认知
- AI **自主维护** — 在对话中学到新信息时自动更新，无需用户手动填写
- 渐进构建 — 从空白开始，随着互动越来越丰富
- **不是档案** — 是宠物对主人的理解，保持自然和温暖

## 文件位置

```
~/.app/workspace/USER.md
```

## 默认模板

```markdown
# 🧑 关于我的主人

<!-- 宠物会在对话中自动了解你，并记录在这里。你也可以直接编辑。 -->

## 基本信息

- **称呼：**
- **时区：**
- **语言偏好：**

## 了解

<!-- 主人关心什么？在做什么项目？有什么习惯？喜欢什么？讨厌什么？ -->

（还没有了解到太多，让我们先聊聊吧。）

---

_了解越多，帮助越好。但这是在了解一个人，不是在建档案。_
```

## 信息类别

| 类别 | 示例 | 优先级 |
|------|------|--------|
| **称呼** | "叫我小明"、"我是 Alice" | 高 — 影响每次对话的称呼 |
| **时区/位置** | "我在北京"、"EST 时区" | 中 — 影响时间相关的回答 |
| **语言偏好** | "用中文回复"、"English please" | 高 — 影响对话语言 |
| **兴趣爱好** | "我喜欢摄影"、"最近在学 Rust" | 低 — 丰富对话体验 |
| **工作/项目** | "我在做一个桌面宠物软件" | 中 — 提供上下文理解 |
| **偏好/习惯** | "不喜欢太长的回复"、"喜欢 emoji" | 中 — 影响回复风格 |
| **重要日期** | "我的生日是 3 月 15 日" | 低 — 可用于惊喜互动 |

## 更新策略

### AI 何时更新 USER.md

| 时机 | 示例 | 操作 |
|------|------|------|
| 用户自我介绍 | "你好，我是小明" | 用 `edit` 填写称呼字段 |
| 对话中透露新信息 | "我最近在学日语" | 用 `edit` 追加到"了解"部分 |
| 用户明确要求记住 | "记住我喜欢简洁的回复" | 用 `edit` 写入偏好 |
| 信息更新 | "我换工作了，现在做前端" | 用 `edit` 修改已有信息 |

### AI 不应该做的

- ❌ 在用户没提供信息时自行猜测并写入
- ❌ 记录敏感私密信息（密码、身份证号等）
- ❌ 把每句话都记录下来（那是 MEMORY.md 的职责）

### 更新方式

- **优先用 `edit`**（局部替换），避免整文件覆盖丢失其他内容
- 新增信息时追加到对应分类下
- 更新已有信息时替换旧值
- 操作后 **无需通知用户**（不像 SOUL.md 需要告知），除非用户主动询问

## 读取与注入

- **读取时机**：每次对话轮次开始时（**仅记忆开启时**）
- **注入位置**：system prompt 的 `# 用户信息` 部分
- **记忆关闭时**：不读取、不注入、不注册 USER.md 相关的 write/edit 工具
- **附加指令**（仅记忆 ON 时）：
  > "USER.md 记录了你对主人的了解。在对话中获知新信息时，使用 edit 工具更新它。不要猜测，只记录主人明确告诉你的事实。"

## 首次对话（Onboarding）

没有 USER.md 或内容为空时，宠物应在自然对话中逐步引出基本信息：

1. 问主人怎么称呼 → 写入称呼
2. 通过对话推断/询问时区 → 写入时区
3. 根据对话语言 → 写入语言偏好

**不要一次性问完所有问题** — 像交朋友一样，慢慢了解。

## 安全约束

- 不记录密码、密钥、身份证号等敏感信息
- 如果用户说"忘了这个"，立即用 `edit` 删除对应内容
- 文件缺失时使用默认空模板创建
